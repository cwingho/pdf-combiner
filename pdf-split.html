<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Splitter</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:wght@400;500;600&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="nav.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#F25F4C',
                    },
                    fontFamily: {
                        display: ['"Bricolage Grotesque"', 'sans-serif'],
                        mono: ['"DM Mono"', 'monospace'],
                    },
                }
            }
        }
    </script>
</head>
<body class="min-h-screen bg-[#f2eee4] px-6 py-10 font-display text-[#0f1d2b] dark:bg-[#050608] dark:text-[#f2f1ed]">
    <div class="fixed inset-0 -z-10">
        <div class="absolute inset-0 opacity-80 bg-[radial-gradient(circle_at_1px_1px,_rgba(15,29,43,0.08)_1px,_transparent_0)] bg-[length:12px_12px] dark:bg-[radial-gradient(circle_at_1px_1px,_rgba(242,241,237,0.08)_1px,_transparent_0)]"></div>
        <div class="absolute inset-0 bg-[linear-gradient(120deg,rgba(242,95,76,0.08),transparent_60%)] dark:bg-[linear-gradient(120deg,rgba(242,95,76,0.15),transparent_65%)]"></div>
    </div>

    <main class="relative mx-auto max-w-5xl space-y-6">
        <div id="nav-container"></div>
        <header class="space-y-3">
            <p class="text-[0.7rem] uppercase tracking-[0.3em] text-black/60 dark:text-white/60">DEVELOPED BY BC</p>
            <h1 class="text-4xl font-semibold leading-tight sm:text-5xl">PDF Splitter</h1>
            <p class="max-w-2xl text-base text-black/70 dark:text-white/70">Break a single document into smaller chunks. Each piece becomes its own file, all processed locally.</p>
        </header>

        <section class="rounded-[30px] border border-black/10 bg-[#f8f1e3] p-8 dark:border-white/10 dark:bg-[#111922]">
            <div id="dropZone" class="flex flex-col items-center justify-center rounded-[24px] border border-dashed border-black/20 bg-white/60 px-6 py-12 text-center dark:border-white/20 dark:bg-white/5">
                <span class="mb-6 flex h-16 w-16 items-center justify-center rounded-full border border-black/30 font-mono text-5xl leading-none dark:border-white/20">+</span>
                <p class="text-2xl font-medium">Drop a PDF or browse</p>
                <p class="mt-2 text-sm text-black/60 dark:text-white/60">Single document only. We'll slice it into separate files.</p>
                <input type="file" id="fileInput" accept=".pdf" class="hidden">
                <button id="selectFilesBtn" class="mt-6 inline-flex items-center justify-center rounded-full border border-transparent bg-primary px-6 py-3 text-xs font-semibold uppercase tracking-[0.3em] text-white">
                    Load PDF
                </button>
            </div>
        </section>

        <section id="settingsPanel" class="hidden rounded-[30px] border border-black/10 bg-[#fff9f2]/90 p-8 dark:border-white/10 dark:bg-[#0f1419]">
            <div class="space-y-1">
                <p class="text-[0.7rem] font-mono uppercase tracking-[0.3em] text-black/50 dark:text-white/50">Source</p>
                <h2 class="text-2xl font-semibold">Loaded document</h2>
            </div>
            <div id="fileMeta" class="mt-4 flex flex-col gap-4 rounded-[20px] border border-black/10 bg-white/80 p-4 text-sm dark:border-white/15 dark:bg-white/5">
                <div class="flex flex-col gap-2 text-black/70 dark:text-white/70 sm:flex-row sm:items-center sm:justify-between">
                    <span id="fileName" class="font-medium break-words sm:max-w-[70%]"></span>
                    <span id="fileSize" class="font-mono text-xs uppercase tracking-[0.2em] text-black/60 dark:text-white/60 sm:text-right"></span>
                </div>
                <div class="flex items-center justify-between text-black/60 dark:text-white/60">
                    <span>Pages</span>
                    <span id="pageCount" class="font-mono text-xs uppercase tracking-[0.2em]">—</span>
                </div>
            </div>

            <div class="mt-6 rounded-[20px] border border-black/10 bg-white/80 p-5 dark:border-white/15 dark:bg-white/5">
                <h3 class="text-lg font-semibold">Split mode</h3>
                <div class="mt-4 space-y-3">
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="radio" name="splitMode" value="pages" checked class="accent-primary">
                        <span class="text-sm text-black/70 dark:text-white/70">Split every <input type="number" id="pagesPerFile" min="1" value="1" class="mx-2 w-16 rounded-lg border border-black/20 bg-white/80 px-2 py-1 text-center font-mono text-sm dark:border-white/20 dark:bg-white/5"> pages</span>
                    </label>
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="radio" name="splitMode" value="count" class="accent-primary">
                        <span class="text-sm text-black/70 dark:text-white/70">Split into <input type="number" id="fileCount" min="2" value="2" class="mx-2 w-16 rounded-lg border border-black/20 bg-white/80 px-2 py-1 text-center font-mono text-sm dark:border-white/20 dark:bg-white/5"> files</span>
                    </label>
                </div>
                <p id="splitPreview" class="mt-4 text-xs font-mono uppercase tracking-[0.2em] text-black/60 dark:text-white/60"></p>
            </div>

            <div class="mt-6 flex flex-wrap gap-3">
                <button id="splitBtn" class="inline-flex items-center justify-center rounded-full border border-transparent bg-primary px-6 py-3 text-sm font-semibold uppercase tracking-[0.2em] text-white disabled:opacity-40" disabled>
                    Split
                </button>
                <button id="clearBtn" class="inline-flex items-center justify-center rounded-full border border-black/20 px-6 py-3 text-sm font-semibold uppercase tracking-[0.2em] text-black/70 dark:border-white/20 dark:text-white/70">
                    Clear
                </button>
            </div>
        </section>

        <section id="progressContainer" class="hidden rounded-[30px] border border-black/10 bg-white/70 p-6 dark:border-white/10 dark:bg-white/5">
            <div class="h-1.5 w-full overflow-hidden rounded-full bg-black/10 dark:bg-white/20">
                <div id="progressBar" class="h-full w-0 bg-primary"></div>
            </div>
            <p id="progressText" class="mt-4 font-mono text-[0.65rem] uppercase tracking-[0.4em] text-black/60 dark:text-white/60">Processing: 0%</p>
        </section>

        <section id="resultContainer" class="hidden rounded-[30px] border border-black/10 bg-white/80 p-8 dark:border-white/15 dark:bg-[#0f1419]">
            <h2 class="text-2xl font-semibold">Split results</h2>
            <div class="mt-4 rounded-[20px] border border-black/10 bg-white/70 p-5 text-sm dark:border-white/15 dark:bg-white/5">
                <div class="flex items-center justify-between text-black/70 dark:text-white/70">
                    <span>Files created</span>
                    <span id="filesCreated" class="font-mono text-xs uppercase tracking-[0.2em]">—</span>
                </div>
            </div>
            <div class="mt-6 flex flex-wrap gap-3" id="resultButtons">
                <button id="downloadZipBtn" class="inline-flex items-center justify-center rounded-full border border-transparent bg-primary px-6 py-3 text-sm font-semibold uppercase tracking-[0.2em] text-white">
                    Download All (ZIP)
                </button>
            </div>
            <div id="fileList" class="mt-6 space-y-3"></div>
        </section>
    </main>

    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        const pdfjsLib = window.pdfjsLib;
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js';
        const PDFLib = window.PDFLib;

        initNavigation('nav-container');

        const fileInput = document.getElementById('fileInput');
        const selectFilesBtn = document.getElementById('selectFilesBtn');
        const settingsPanel = document.getElementById('settingsPanel');
        const splitBtn = document.getElementById('splitBtn');
        const clearBtn = document.getElementById('clearBtn');
        const pagesPerFileInput = document.getElementById('pagesPerFile');
        const fileCountInput = document.getElementById('fileCount');
        const splitModeRadios = document.querySelectorAll('input[name="splitMode"]');
        const splitPreview = document.getElementById('splitPreview');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const resultContainer = document.getElementById('resultContainer');
        const downloadZipBtn = document.getElementById('downloadZipBtn');
        const fileList = document.getElementById('fileList');
        const filesCreated = document.getElementById('filesCreated');

        const fileNameEl = document.getElementById('fileName');
        const fileSizeEl = document.getElementById('fileSize');
        const pageCountEl = document.getElementById('pageCount');

        let pdfFile = null;
        let totalPages = 0;
        let splitResults = [];

        selectFilesBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileSelection);
        clearBtn.addEventListener('click', clearFile);
        splitBtn.addEventListener('click', splitPdf);
        downloadZipBtn.addEventListener('click', downloadZip);

        splitModeRadios.forEach(radio => {
            radio.addEventListener('change', updateSplitPreview);
        });
        pagesPerFileInput.addEventListener('input', updateSplitPreview);
        fileCountInput.addEventListener('input', updateSplitPreview);

        function updateSplitPreview() {
            if (!totalPages) return;
            
            const mode = document.querySelector('input[name="splitMode"]:checked').value;
            let result = '';
            
            if (mode === 'pages') {
                const pagesPerFile = parseInt(pagesPerFileInput.value) || 1;
                const fileCount = Math.ceil(totalPages / pagesPerFile);
                result = `${fileCount} files (${pagesPerFile} pages each, last may be shorter)`;
            } else {
                const fileCount = parseInt(fileCountInput.value) || 2;
                const pagesPerFile = Math.ceil(totalPages / fileCount);
                result = `${fileCount} files (approximately ${pagesPerFile} pages each)`;
            }
            
            splitPreview.textContent = result;
        }

        async function handleFileSelection(event) {
            const file = event.target.files[0];

            if (!file || file.type !== 'application/pdf') {
                return;
            }

            pdfFile = file;
            fileNameEl.textContent = file.name;
            fileNameEl.title = file.name;
            fileSizeEl.textContent = formatFileSize(file.size);
            fileSizeEl.title = formatFileSize(file.size);
            splitBtn.disabled = true;
            pageCountEl.textContent = 'Parsing…';
            settingsPanel.classList.remove('hidden');
            resultContainer.classList.add('hidden');

            try {
                const arrayBuffer = await readFileAsArrayBuffer(file);
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                totalPages = pdf.numPages;
                pageCountEl.textContent = totalPages;
                splitBtn.disabled = false;
                updateSplitPreview();
            } catch (error) {
                pageCountEl.textContent = 'Error';
                console.error('Unable to read PDF:', error);
            }
        }

        function clearFile() {
            pdfFile = null;
            totalPages = 0;
            splitResults = [];
            fileInput.value = '';
            settingsPanel.classList.add('hidden');
            resultContainer.classList.add('hidden');
            progressContainer.classList.add('hidden');
            splitBtn.disabled = true;
            fileNameEl.textContent = '';
            fileNameEl.removeAttribute('title');
            fileSizeEl.textContent = '';
            fileSizeEl.removeAttribute('title');
            pageCountEl.textContent = '—';
            splitPreview.textContent = '';
        }

        async function splitPdf() {
            if (!pdfFile || !totalPages) return;

            progressContainer.classList.remove('hidden');
            progressBar.style.width = '0%';
            progressText.textContent = 'Processing: 0%';
            splitBtn.disabled = true;
            splitResults = [];

            try {
                const mode = document.querySelector('input[name="splitMode"]:checked').value;
                const sourceBytes = await readFileAsArrayBuffer(pdfFile);
                const sourcePdf = await PDFLib.PDFDocument.load(sourceBytes);
                const sourcePageIndices = sourcePdf.getPageIndices();

                let ranges = [];
                if (mode === 'pages') {
                    const pagesPerFile = parseInt(pagesPerFileInput.value) || 1;
                    for (let i = 0; i < sourcePageIndices.length; i += pagesPerFile) {
                        ranges.push(sourcePageIndices.slice(i, i + pagesPerFile));
                    }
                } else {
                    const fileCount = parseInt(fileCountInput.value) || 2;
                    const pagesPerFile = Math.ceil(sourcePageIndices.length / fileCount);
                    for (let i = 0; i < sourcePageIndices.length; i += pagesPerFile) {
                        ranges.push(sourcePageIndices.slice(i, i + pagesPerFile));
                    }
                }

                for (let i = 0; i < ranges.length; i++) {
                    const range = ranges[i];
                    const newPdf = await PDFLib.PDFDocument.create();
                    const pages = await newPdf.copyPages(sourcePdf, range);
                    pages.forEach(page => newPdf.addPage(page));

                    const pdfBytes = await newPdf.save();
                    const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                    const url = URL.createObjectURL(blob);
                    
                    splitResults.push({
                        url,
                        blob,
                        index: i + 1,
                        pages: range.length,
                        startPage: range[0] + 1,
                        endPage: range[range.length - 1] + 1
                    });

                    const progress = Math.round(((i + 1) / ranges.length) * 100);
                    progressBar.style.width = `${progress}%`;
                    progressText.textContent = `Processing: ${progress}%`;
                }

                displayResults();
                resultContainer.classList.remove('hidden');

                setTimeout(() => {
                    progressContainer.classList.add('hidden');
                }, 400);
            } catch (error) {
                console.error('Split failed:', error);
                alert('Unable to split this PDF. Try another file.');
                progressContainer.classList.add('hidden');
            } finally {
                splitBtn.disabled = false;
            }
        }

        function displayResults() {
            filesCreated.textContent = splitResults.length;
            fileList.innerHTML = '';

            splitResults.forEach((result, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'flex flex-wrap items-center gap-4 rounded-[18px] border border-black/10 bg-white/70 px-4 py-3 text-sm dark:border-white/15 dark:bg-white/5';
                fileItem.innerHTML = `
                    <span class="flex h-10 w-10 items-center justify-center rounded-lg border border-black/15 bg-primary/15 text-primary dark:border-white/20">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                    </span>
                    <div class="min-w-0 flex-1">
                        <p class="font-medium">Part ${result.index} (pages ${result.startPage}-${result.endPage})</p>
                        <p class="text-xs text-black/60 dark:text-white/60">${formatFileSize(result.blob.size)}</p>
                    </div>
                    <a href="${result.url}" download="part_${result.index}_pages_${result.startPage}-${result.endPage}.pdf" class="inline-flex items-center justify-center rounded-full border border-transparent bg-primary px-4 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-white">
                        Download
                    </a>
                `;
                fileList.appendChild(fileItem);
            });
        }

        async function downloadZip() {
            if (!splitResults.length) return;

            const zip = new JSZip();
            
            splitResults.forEach(result => {
                const filename = `part_${result.index}_pages_${result.startPage}-${result.endPage}.pdf`;
                zip.file(filename, result.blob);
            });

            const zipBlob = await zip.generateAsync({ type: 'blob' });
            const zipUrl = URL.createObjectURL(zipBlob);
            const a = document.createElement('a');
            a.href = zipUrl;
            a.download = `split_${new Date().toISOString().slice(0, 10)}.zip`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(zipUrl);
        }

        function readFileAsArrayBuffer(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return `${parseFloat((bytes / Math.pow(k, i)).toFixed(2))} ${sizes[i]}`;
        }

        const dropZone = document.getElementById('dropZone');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });

        dropZone.addEventListener('drop', handleDrop, false);

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function highlight() {
            dropZone.style.borderColor = '#F25F4C';
            dropZone.style.backgroundColor = 'rgba(242, 95, 76, 0.1)';
        }

        function unhighlight() {
            dropZone.style.borderColor = '';
            dropZone.style.backgroundColor = '';
        }

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files && files.length) {
                fileInput.files = files;
                const changeEvent = new Event('change');
                fileInput.dispatchEvent(changeEvent);
            }
        }
    </script>
</body>
</html>

